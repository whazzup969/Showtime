<!DOCTYPE html>
<html>

<body>
  <p id="demo">Click the button to get your coordinates.</p>
  <button onclick="getLocation()">Try It</button>

  <p id="zipcodeholder"></p>
  <p id="moviedataholder"></p>


  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
  <script type='text/javascript' src="xml2json.js"></script>
  <script>
    var geocoder;
    var request = new XMLHttpRequest();
    var movieDataJSON;
    var x2js = new X2JS();

    var x = document.getElementById("demo");

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        x.innerHTML = "GeoLocation is not supported by this browser.";
      }
    }

    function getPostalCode(results){
      var postalCode;
      var resultsLen = results.length;
      for(var i = 0; i < resultsLen; i++)
      {
        var componentsLen = results[i].address_components.length;
        for(var j = 0; j < componentsLen; j++)
        {
          var typesLen = results[i].address_components[j].types.length;
          for(var k = 0; k < typesLen; k++)
          {
            if(results[i].address_components[j].types[k] == "postal_code")
            {
              postalCode = results[i].address_components[j].short_name;
              return postalCode;
            }
          }
        }
      }
      return postalCode;
    }

    function getMovieData(postalCode){
      var url = "http://www.fandango.com/rss/moviesnearme_"+postalCode+".rss";
      var x = new XMLHttpRequest();
      x.open("GET","ba-simple-proxy.php?url="+url,true);
      x.onreadystatechange = function () {
        if(x.readyState == 4 && x.status == 200)
        {
          movieDataJSON = JSON.parse(x.responseText);
          var jsonObj = x2js.xml_str2json(movieDataJSON.contents);
          var channelLen = jsonObj.rss.channel.item.length;
          for(var i = 0; i < channelLen; i++)
          {
            document.getElementById("moviedataholder").innerHTML += "<p>"+jsonObj.rss.channel.item[i].title+"</p>";
            document.getElementById("moviedataholder").innerHTML += jsonObj.rss.channel.item[i].description;
          }
        }
      };
      x.send(null);

    }

    function showPosition(position) {
      geocoder = new google.maps.Geocoder();
      var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      geocoder.geocode({
        'latLng': latlng
      }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          var zipCode = getPostalCode(results);
          if (zipCode.length > 0) {
            document.getElementById("zipcodeholder").innerHTML = "Postal Code: " + zipCode;
            getMovieData(zipCode);
          } else {
            alert("No results found");
          }
        } else {
          alert("Geocoder failed due to: " + status);
        }
      });
    }

    function showError(error) {
      switch (error.code) {
        case error.PERMISSION_DENIED:
          x.innerHTML = "User denied the request for Geolocation.";
          break;
        case error.POSITION_UNAVAILABLE:
          x.innerHTML = "Location information is unavailable.";
          break;
        case error.TIMEOUT:
          x.innerHTML = "The request to get user location timed out."
          break;
        case error.UNKNOWN_ERROR:
          x.innerHTML = "An unknown error occurred.";
          break;
      }
    }
  </script>
</body>
</html
